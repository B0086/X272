using System;
using System.IO;
using System.Net;
using System.Text;
using System.Threading;

class Program
{
    static void Main(string[] args)
    {
        string originalUrl = "http://45.13.227.206";
        string redirectUrl = "http://185.205.19.150";

        // TCP dinleyici oluştur
        TcpListener listener = new TcpListener(IPAddress.Any, 80);
        listener.Start();

        Console.WriteLine("Listening for requests...");

        while (true)
        {
            // Bağlantı kabul et
            TcpClient client = listener.AcceptTcpClient();
            Thread thread = new Thread(() =>
            {
                using (NetworkStream stream = client.GetStream())
                using (StreamReader reader = new StreamReader(stream, Encoding.UTF8))
                using (StreamWriter writer = new StreamWriter(stream, Encoding.UTF8) { AutoFlush = true })
                {
                    // İstek satırını oku
                    string requestLine = reader.ReadLine();
                    if (!string.IsNullOrEmpty(requestLine))
                    {
                        // İstek satırını parçala
                        string[] parts = requestLine.Split(' ');
                        string method = parts[0];
                        string url = parts[1];

                        // Yönlendirme işlemi
                        if (url.StartsWith(originalUrl))
                        {
                            string newUrl = redirectUrl + url.Substring(originalUrl.Length);
                            writer.WriteLine("HTTP/1.1 302 Found");
                            writer.WriteLine($"Location: {newUrl}");
                            writer.WriteLine();
                            Console.WriteLine($"Redirected: {url} to {newUrl}");
                        }
                        else
                        {
                            // Yönlendirme yapılacak URL değilse, isteği ileterek normal işlem devam ettirilir.
                            writer.WriteLine("HTTP/1.1 200 OK");
                            writer.WriteLine("Content-Type: text/html; charset=utf-8");
                            writer.WriteLine();
                            writer.WriteLine("<!DOCTYPE html><html><body><h1>Hello, World!</h1></body></html>");
                            Console.WriteLine($"Processed: {url}");
                        }
                    }
                }
                client.Close();
            });
            thread.Start();
        }
    }
}
